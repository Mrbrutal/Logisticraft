<?xml version="1.0" encoding="UTF-8" ?>
<project name="Logisticraft" basedir="." default="all">

    <!-- Description of the mod -->
	<description>Logisticraft a mod in writing.</description>
	
	<!-- Your name here -->
	<property name="author" value="Mrbrutal" />

	<!-- Your release version here -->
	<property name="version" value="1.0.0" />

	<!-- Choose ".zip" or ".jar" as the dist file extension -->
	<property name="filetype" value="jar" />

	<!-- Update if mcp directory isn't in same location as this file -->
	<property name="mcp.dir" location="../.." />

	<!-- Update if dist directory isn't in same location as this file -->
	<property name="dist.dir" location="../../../Builds/dist" />

	<!-- Update only if build directory isn't in same location as this file -->
	<property name="build.dir" location="../../../Builds/build" />
	
	<property name="srcCommon.dir" location="${mcp.dir}/src/common/si/meansoft/logisticraft/common" />
	<property name="srcClient.dir" location="${mcp.dir}/src/common/si/meansoft/logisticraft/client" />
	<property name="resources.dir" location="${mcp.dir}/eclipse/logisticraft/resources" />

	<!-- Update to point to your Python executable. Example: /usr/bin/python -->
	<!-- The following location is for Windows:	-->
	<property name="python" location="${mcp.dir}/runtime/bin/python/python_mcp.exe" />

	<target name="pre" description="Copy the source files">
		<echo message="Cleaning old sources" />
        <delete dir="${mcp.dir}/src/common" />
        <delete dir="${mcp.dir}/src/minecraft" />
        <delete dir="${mcp.dir}/src/minecraft_server" />

        <echo message="Creating src folders" />
        <mkdir dir="${srcCommon.dir}" />
        <mkdir dir="${srcClient.dir}" />
		
		<echo message="Copying sources to MCP/src" />
		<copy todir="${srcCommon.dir}">
			<fileset dir="${mcp.dir}/eclipse/Logisticraft/common/si/meansoft/logisticraft" />
		</copy>
		<copy todir="${srcClient.dir}">
			<fileset dir="${mcp.dir}/eclipse/Logisticraft/client/si/meansoft/logisticraft" />        
		</copy>
	</target>
	
	<target name="init" description="Initialize build environment">
		<echo message="Cleaning old build and dist, MCP reobf directories" />
		<delete dir="${build.dir}" />
		<delete dir="${dist.dir}" />
		<delete dir="${mcp.dir}/reobf" />

		<echo message="Creating build and dist dirs" />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${dist.dir}" />
	</target>

	<target name="recompile" description="MCP recompile" >
		<exec executable="${python}" dir="${mcp.dir}">
			<arg value="runtime/recompile.py"/>
			<arg value="%*"/>
		</exec>
	</target>

	<target name="reobfuscate" description="MCP reobfuscate">
		<exec executable="${python}" dir="${mcp.dir}">
			<arg value="runtime/reobfuscate.py"/>
			<arg value="%*"/>
		</exec>
	</target>

	<target name="stage" description="Stage resources into build directory">
		<copy todir="${build.dir}">
			<fileset dir="${mcp.dir}/reobf/common" excludes=".svn/**, *.txt" />
			<fileset dir="${resources.dir}" excludes=".svn/**" />
			<fileset dir="${mcp.dir}/eclipse">
				<include name="**/mcmod.info" />
			</fileset>
		</copy>
		<!-- Copy other stuff specific to your project -->
		
	</target>

	<target name="all" description="Perform all tasks for a build" depends="pre, init, recompile, reobfuscate, stage">
		<echo message="MCP Ant Build Completed!" />
	</target>

	<target name="jarzip" description="Jar (or zip) the project's dist output">
		<mkdir dir="${dist.dir}" />
		<jar destfile="${dist.dir}/${ant.project.name}${version}.${filetype}" duplicate="preserve" index="true" manifestencoding="UTF-8">
			<manifest>
				<attribute name="Built-By" value="MCP (http://mcp.ocean-labs.de)"/>
				<attribute name="Implementation-Vendor" value="${author}"/>
				<attribute name="Implementation-Title" value="${ant.project.name}"/>
				<attribute name="Implementation-Version" value="${version}"/>
			</manifest>
			<fileset dir="${build.dir}" />
		</jar>
	</target>

</project>