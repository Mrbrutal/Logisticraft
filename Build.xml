<?xml version="1.0" encoding="UTF-8" ?>
<project name="Logisticraft" basedir="." default="all">

    <!-- Description of the mod -->
	<description>Logisticraft a mod in writing.</description>
	
	<!-- Author -->
	<property name="author"            value="Mrbrutal" />

	<!-- Version -->
	<property name="version"           value="1.0.0" />

	<!-- ".zip" or ".jar" as the dist file extension -->
	<property name="filetype"          value="jar" />

	<!-- MCP main directory -->
	<property name="mcp.dir"           location="../.." />
	
	<!-- MCP eclipse directory -->
	<property name="mcp.ecl"           location="../../eclipse/Logisticraft" />

	<!-- Dist directory -->
	<property name="dist.dir"          location="../../../Builds/dist" />

	<!-- Build directory -->
	<property name="build.dir"         location="../../../Builds/build" />
	
	<property name="srcCommon.dir"     location="${mcp.dir}/src/common/si/meansoft/logisticraft/common" />
	<property name="srcClient.dir"     location="${mcp.dir}/src/common/si/meansoft/logisticraft/client" />
	<property name="resources.dir"     location="${mcp.dir}/eclipse/logisticraft/resources" />
	
	<property name="mcp.version"       value="7.0.2"/>
    <property name="forge.version"     value="4.0.0.217"/>
    <property name="lc.version"        value="1.0.0_000"/>
	
	<!-- Set up additional variables -->
	<target name="SetUp">
	    <tstamp>
	      <format pattern="ddMMyy-HHmmss" property="timestamp" />
	    </tstamp>
	    <property environment="env" />
	    <property file="build.properties" />
	    <property name="modname" value="mod_ironchests" />
	    <condition property="python.exe" value="${mcp.home}/runtime/bin/python/python_mcp" else="python">
	      <os family="Windows" />
	    </condition>
	    <condition property="version.build" value="${env.BUILD_NUMBER}" else="1">
	    	   <isset property="env.BUILD_NUMBER" />
	    </condition>
	</target>
	
	<!-- Get version from python script -->
	<target name="GetVer" depends="SetUp">
        <exec executable="${python.exe}" dir="${mcp.ecl}" failonerror="true">
            <arg value="${mcp.ecl}/CalcVer.py" />
            <arg value="${ecl}" />
        </exec>
        <propertyfile file="lcver.properties">
            <entry key="lc.build.build.number" type="int" value="${version.build}"/>
        </propertyfile>
	</target>
	
	<!-- Prepare sources -->
	<target name="PreInit" description="Prepare and copy SRC">
		<echo message="Cleaning old sources" />
        <delete dir="${mcp.dir}/src/common/si" />
        <delete dir="${mcp.dir}/src/minecraft/si" />
        <delete dir="${mcp.dir}/src/minecraft_server/si" />

        <echo message="Creating src folders" />
        <mkdir dir="${srcCommon.dir}" />
        <mkdir dir="${srcClient.dir}" />
		
		<echo message="Copying sources to MCP/src" />
		<copy todir="${srcCommon.dir}">
			<fileset dir="${mcp.dir}/eclipse/Logisticraft/common/si/meansoft/logisticraft/common" />
		</copy>
		<copy todir="${srcClient.dir}">
			<fileset dir="${mcp.dir}/eclipse/Logisticraft/client/si/meansoft/logisticraft/client" />        
		</copy>
	</target>
	
	<target name="Init" description="Initialize build environment">
		<echo message="Cleaning old build and dist, MCP reobf directories" />
		<delete dir="${build.dir}" />
		<delete dir="${dist.dir}" />
		<delete dir="${mcp.dir}/reobf" />

		<echo message="Creating build and dist dirs" />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${dist.dir}" />
	</target>
	
	<target name="PostInit" description="Initialize build environment">
	        <echo message="Cleaning old build and dist, MCP reobf directories" />
	</target>

	<target name="recompile" description="MCP recompile" >
		<exec executable="${python}" dir="${mcp.dir}">
			<arg value="runtime/recompile.py"/>
			<arg value="%*"/>
		</exec>
	</target>

	<target name="reobfuscate" description="MCP reobfuscate">
		<exec executable="${python}" dir="${mcp.dir}">
			<arg value="runtime/reobfuscate.py"/>
			<arg value="%*"/>
		</exec>
	</target>

	<target name="stage" description="Stage resources into build directory">
		<copy todir="${build.dir}">
			<fileset dir="${mcp.dir}/reobf/common" excludes=".svn/**, *.txt" />
			<fileset dir="${resources.dir}" excludes=".svn/**" />
			<fileset dir="${mcp.dir}/eclipse">
				<include name="**/mcmod.info" />
			</fileset>
		</copy>
		<!-- Copy other stuff specific to your project -->
		
	</target>

	<target name="all" description="Perform all tasks for a build" depends="PreInit"> <!-- , Init, PostInit, recompile, reobfuscate, stage -->
		<echo message="Build of Logisticraft Completed!" />
	</target>

	<target name="jarzip" description="Jar (or zip) the project's dist output">
		<mkdir dir="${dist.dir}" />
		<jar destfile="${dist.dir}/${ant.project.name}${version}.${filetype}" duplicate="preserve" index="true" manifestencoding="UTF-8">
			<manifest>
				<attribute name="Built-By" value="MCP (http://mcp.ocean-labs.de)"/>
				<attribute name="Implementation-Vendor" value="${author}"/>
				<attribute name="Implementation-Title" value="${ant.project.name}"/>
				<attribute name="Implementation-Version" value="${version}"/>
			</manifest>
			<fileset dir="${build.dir}" />
		</jar>
	</target>

</project>